<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marilaine Lima Rodrigues, RA: 257286">

<title>Desafio 06</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="257286_D6_2S2025_ME315_files/libs/clipboard/clipboard.min.js"></script>
<script src="257286_D6_2S2025_ME315_files/libs/quarto-html/quarto.js"></script>
<script src="257286_D6_2S2025_ME315_files/libs/quarto-html/popper.min.js"></script>
<script src="257286_D6_2S2025_ME315_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="257286_D6_2S2025_ME315_files/libs/quarto-html/anchor.min.js"></script>
<link href="257286_D6_2S2025_ME315_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="257286_D6_2S2025_ME315_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="257286_D6_2S2025_ME315_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="257286_D6_2S2025_ME315_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="257286_D6_2S2025_ME315_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Desafio 06</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Marilaine Lima Rodrigues, RA: 257286 </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>1.Baixe o arquivo disco.db e armazene na variável path o caminho completo (pasta) na qual o arquivo foi gravado. Utilize o comando file.path() para combinar a variável path com o nome do arquivo (disco.db) e obter o nome do arquivo com seu respectivo caminho. Armazene este resultado na variável fname. <code>Obs.</code>: Por mais que no Lab06 pede o caminho absoluto - que é o caminho completo - para o arquivo, no desafio é pedido o caminho relativo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>path  <span class="ot">&lt;-</span> <span class="st">"."</span>   <span class="co"># Define o caminho relativo como a pasta atual (".").</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(path, <span class="st">"disco.db"</span>) <span class="co"># Combina o caminho definido em 'path' com o nome do arquivo "disco.db",</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># criando o caminho completo para o arquivo do banco de dados.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Se 'path' for ".", 'fname' será "./disco.db".</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># file.exists(fname)  # verifica se está rodando corretamente </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>2.Utilizando o pacote RSQLite, conecte-se ao arquivo de banco de dados. Armazene a conexão na variável conn.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), fname)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria uma conexão com o banco de dados SQLite armazenado no arquivo 'fname'.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 'conn' é o objeto que representa a conexão ativa, usado em todas as consultas.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Liste as tabelas existentes no banco de dados.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tabelas <span class="ot">&lt;-</span> <span class="fu">dbListTables</span>(conn) <span class="co"># Lista todas as tabelas disponíveis no banco de dados conectado.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># O resultado é um vetor de nomes de tabelas.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>tabelas  <span class="co"># Exibe na tela o vetor com os nomes das tabelas.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "albums"          "artists"         "customers"       "employees"      
 [5] "genres"          "invoice_items"   "invoices"        "media_types"    
 [9] "playlist_track"  "playlists"       "sqlite_sequence" "sqlite_stat1"   
[13] "tracks"         </code></pre>
</div>
</div>
<p><code>Resposta:</code> Neste banco de dados temos as seguintes tabelas: albums, artists, customers, employees, genres, invoice_items, invoices, media_types, playlist_track, playlists, sqlite_sequence, sqlite_stat1, tracks, totalizando 13 tabelas.</p>
<ol start="4" type="1">
<li>Identifique os nomes de todas as colunas existentes na tabela customers.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>colunas_customers <span class="ot">&lt;-</span> <span class="fu">dbListFields</span>(conn, <span class="st">"customers"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Retorna os nomes de todas as colunas da tabela 'customers'.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># O resultado é um vetor de strings com os nomes das colunas.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Resposta:</code> A tabela customers possui as seguintes colunas: CustomerId, FirstName, LastName, Company, Address, City, State, Country, PostalCode, Phone, Fax, Email, SupportRepId, totalizando 13 colunas.</p>
<ol start="5" type="1">
<li>Utilizando apenas SQLite, com o apoio do comando dbGetQuery, identifique quantos clientes estão atualmente cadastrados neste banco de dados.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>total_clientes <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="st">"SELECT COUNT(*) AS n FROM customers"</span>)<span class="sc">$</span>n</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Executa a consulta SQL que conta o número total de clientes na tabela 'customers'.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 'dbGetQuery' envia a consulta para o banco e retorna os resultados em um data frame.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># O '$n' extrai diretamente o valor da contagem como número.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Resposta:</code> O banco de dados possui atualmente 59 clientes cadastrados.</p>
<ol start="6" type="1">
<li>Utilizando apenas SQLite, identifique o número de países diferentes em que moram os clientes encontrados acima.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>total_paises <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="st">"SELECT COUNT(DISTINCT Country) AS n FROM customers"</span>)<span class="sc">$</span>n</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Executa a consulta SQL que conta quantos países distintos existem na coluna 'Country' da tabela 'customers'.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># O '$n' extrai o valor diretamente da coluna 'n' do data frame retornado.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Resposta:</code> Os clientes estão distribuídos em 24 países diferentes.</p>
<ol start="7" type="1">
<li>Utilizando apenas SQLite, quantos clientes existem por país? A tabela resultante deve conter o nome do país e a respectiva contagem, além de ser ordenada de maneira decrescente pela referida contagem.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(conn, <span class="st">"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT Country, COUNT(*) AS total_clientes</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM customers</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY Country</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY total_clientes DESC</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Country total_clientes
1             USA             13
2          Canada              8
3          France              5
4          Brazil              5
5         Germany              4
6  United Kingdom              3
7        Portugal              2
8           India              2
9  Czech Republic              2
10         Sweden              1
11          Spain              1
12         Poland              1
13         Norway              1
14    Netherlands              1
15          Italy              1
16        Ireland              1
17        Hungary              1
18        Finland              1
19        Denmark              1
20          Chile              1
21        Belgium              1
22        Austria              1
23      Australia              1
24      Argentina              1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consulta SQL:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Seleciona o país e a contagem de clientes em cada país.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - 'GROUP BY Country' agrupa os registros por país.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - 'ORDER BY total_clientes DESC' ordena do maior para o menor número de clientes.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># O resultado é uma tabela com dois campos: país e número de clientes.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="8" type="1">
<li>Quais são os 5 países com mais clientes registrados? Use apenas SQLite.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>top5_paises <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="st">"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT Country, COUNT(*) AS total_clientes</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM customers</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY Country</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY total_clientes DESC</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="st">  LIMIT 5</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Consulta SQL:</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># - Igual à anterior, mas com 'LIMIT 5' para mostrar apenas os 5 primeiros países.</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># O resultado é armazenado em 'top5_paises'.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Respostas:</code> Os 5 países com mais clientes registrados são: USA, Canada, France, Brazil, Germany com quantidades 13, 8, 5, 5, 4, respectivamente.</p>
<ol start="9" type="1">
<li>Quais são os países registrados que possuem apenas 6 letras no nome?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>paises <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="st">"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT DISTINCT Country</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM customers</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE LENGTH(Country) = 6</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Consulta SQL:</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - Seleciona os nomes dos países distintos da tabela 'customers'.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - Usa a função LENGTH() para filtrar apenas aqueles com 6 caracteres.</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># O resultado é uma lista de países com nomes de 6 letras.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Resposta:</code> Os países que possuem exatamente 6 letras no nome são: Brazil, Canada, Norway, France, Poland, Sweden.</p>
<ol start="10" type="1">
<li>Quais foram as músicas compradas por clientes brasileiros?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>musicas_br <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="st">"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT DISTINCT t.Name AS Musica</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM customers c</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN invoices i ON c.CustomerId = i.CustomerId</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN invoice_items ii ON i.InvoiceId = ii.InvoiceId</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN tracks t ON ii.TrackId = t.TrackId</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE c.Country = 'Brazil'</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY t.Name</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>musicas_br</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                      Musica
1                                                                                   1/2 Full
2                                                                      2 Minutes To Midnight
3                                                                               A Cor Do Sol
4                                                                                     A Cura
5                                                                             A Menina Dança
6                                                                   Abraham, Martin And John
7                                                                                  Aces High
8                                                                        Admirável Gado Novo
9                                                                   All Along The Watchtower
10                                                                         All I Want Is You
11                                                                                     Aloha
12                                                                             Amor De Muito
13                                                                                    Animal
14                                                                       Any Colour You Like
15                                                                                 Aos Leões
16                                                                                  Babyface
17                                                                            Back off Bitch
18                                                                                       Bad
19                                                                                  Bad Seed
20                                                                 Banditismo Por Uma Questa
21                                                                            Be Good Johnny
22                                                                                   Be Mine
23                                                                                  Big Wave
24                                                                         Binky The Doormat
25                                                                            Bittersweet Me
26                                                                                     Black
27                                                                      Black Light Syndrome
28                                                                                 Bora-Bora
29                                                                                     Bossa
30                                                                         Burden In My Hand
31                                                                          Calling Dr. Love
32                                                                Carolina Hard-Core Ecstasy
33                                                                                      Casa
34                                                                    Caso Você Queira Saber
35                                                                             Child In Time
36                                                                               Cinema Mudo
37                                                                                  Cold Gin
38                                                                                      Coma
39                                                                Communication Breakdown(2)
40                                                                             Cristina Nº 2
41                                                                                Cropduster
42                                                                              Cry For Love
43                                                                        Cérebro Eletrônico
44                                                                              D'Yer Mak'er
45                                                                               Damage Inc.
46                                                                                     Dance
47                                                                                  Demorou!
48                                                                                 Dissident
49                                                                      Don't Cry (Original)
50                                                                           Don't Look Back
51                                                                                    Doutor
52                                                                                Down Under
53                                                                           Down by the Sea
54                                                                                   Drifter
55                                                                                  Duelists
56                                                                             Dust N' Bones
57                                                                               Electrolite
58                                                                               Eu Amo Você
59                                                                         Everything I Need
60                                                                       Experiment In Terra
61                                                                                       Eye
62                                                                  Fantasia On Greensleeves
63                                                                           Fast As a Shark
64                                                                                    Flower
65                                                                         Flying High Again
66                                                                          Fool In The Rain
67                                                                            Garden of Eden
68                                                                       Get Down, Make Love
69                                                                                    Get Up
70                                                                      Girl From A Pawnshop
71                                                                                   Go Down
72                                                                             Green Disease
73                                                                           Grito De Alerta
74                                                 Heart Of Lothian: Wide Boy / Curtain Call
75                                                              Hell Ain't A Bad Place To Be
76                                                                             Help Yourself
77                                                                           Home Sweet Home
78                                                                           I Belong To You
79                                                         I Feel Good (I Got You) - Sossego
80                                                                                  In Bloom
81                                                                            In The Evening
82                                                                           Interlude Zumbi
83                                                                            Into The Light
84                                                                                     Intro
85                                                                             Ipiranga 2001
86                                                                       Is This Love (Live)
87                                                                            It's a Mistake
88                                                                         Jesus Christ Pose
89                                      Karelia Suite, Op.11: 2. Ballade (Tempo Di Menuetto)
90                                                                Knocking At Your Back Door
91                                                                            Lay Down Sally
92                                                                                     Leash
93                                                                             Leper Messiah
94                                                                            Like A Song...
95                                                                        Lindo Lago Do Amor
96                                                                          Linha Do Equador
97                                                                          Live and Let Die
98                                                                            Lixo Do Mangue
99                                                                              Losfer Words
100                                                                    Mama, I'm Coming Home
101                                                                Maracatu De Tiro Certeiro
102                                                                             Mateus Enter
103                                                                          Maybe I'm A Leo
104                                                                  Mensagen De Amor (2000)
105                                                                           Meu Caro Amigo
106                                                                                 Meu Erro
107                                                             Midnight From The Inside Out
108                                       Mis Penas Lloraba Yo (Ao Vivo) Soy Gitano (Tangos)
109                                                                         Morena De Angola
110                                                                                Most High
111                                                                                 Mundaréu
112 Music for the Funeral of Queen Mary: VI. "Thou Knowest, Lord, the Secrets of Our Hearts"
113                                                                      Nega Do Cabelo Duro
114                                                                                 No No No
115                                                                               No Quarter
116                                                                   Nossa Gente (Avisa Là)
117                                                                              Nosso Adeus
118                                                                            Não Vou Ficar
119                                                             O Descobridor Dos Sete Mares
120                                                                              O Leaozinho
121                                                                         O Que Me Importa
122                                                                                   Oceans
123                                                                               On A Plain
124                                                                            Pais E Filhos
125                                                                                 Paranoid
126                                                                           Pick Myself Up
127                                                                                 Plot 180
128                                                                               Podes Crer
129                                                                    Ponto De Interrogação
130                                                                               Powerslave
131                                                                                   Praise
132                                                                                Red Light
133                                                                                Redundant
134                                                                          Refavela (Live)
135                                                                             Reggae Tchan
136                                                                           Revolta Olodum
137                                                                  Right Next Door to Hell
138                                                                 Rios Pontes &amp; Overdrives
139                                                                    Rock And Roll Is Dead
140                                                                             Rocket Queen
141                                                                               Saber Amar
142                                                                            Samba Do Lado
143                                                                                Sanctuary
144                                        Saudade Dos Aviões Da Panair (Conversando No Bar)
145                                                                     Scentless Apprentice
146                                                                                 Selvagem
147                                                                                   Sereia
148                                                                                     Será
149                                                                     Será Que Vai Chover?
150                                                                       Seven Seas Of Rhye
151                                                                       Shakes and Ladders
152                                                                        Shout It Out Loud
153                                                                             Sincero Breu
154                                                                                  Slither
155                                                                               Snowballed
156                                                                         So Fast, So Numb
157                                                                      Sometimes Salvation
158                                                                             Soul Singing
159                                                                   Stand Inside Your Love
160                                                                        Stir It Up (Live)
161     String Quartet No. 12 in C Minor, D. 703 "Quartettsatz": II. Andante - Allegro assai
162                                                                                 Strutter
163                                          Suite No. 3 in D, BWV 1068: III. Gavotte I &amp; II
164                                                                           Sweetest Thing
165       Symphony No. 2, Op. 16 -  "The Four Temperaments": II. Allegro Comodo e Flemmatico
166                                                                        Take the Celestra
167                                                                  The Day I Tried To Live
168                                                                 The Great Gig In The Sky
169                                                                       The Memory Remains
170                                                                        The Unforgiven II
171                                                                        The Unwritten Law
172                                                                          Think About You
173                                                                               Title Song
174                                                                                  Top Top
175                                                                               TriboTchan
176                                                                    Um Satélite Na Cabeça
177                                                                                 Untitled
178                                                                               Vai Passar
179                                                                                Vai Valer
180                                                                           Vamo Batê Lata
181                                                                Vavoom : Ted The Mechanic
182                                                        Voce Nao Entende Nada - Cotidiano
183                                                                   Wanted Dread And Alive
184                                                                                   Why Go
185                                                                                 X-9 2001
186                                                                    You're My Best Friend
187                                                           You've Been A Long Time Coming
188                                                                           Your Blue Room
189                                                                            Água de Beber</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consulta SQL:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Relaciona clientes → faturas → itens da fatura → faixas de música.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Seleciona apenas os clientes cujo 'Country' é 'Brazil'.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - Retorna os nomes distintos das músicas compradas.</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - 'ORDER BY t.Name' ordena os resultados em ordem alfabética.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Qual o álbum mais tocado por país?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Álbum mais tocado por país</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>sql_album_por_pais <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="st">WITH album_country_counts AS (</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT c.Country,</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="st">         al.AlbumId,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="st">         al.Title AS Album,</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="st">         COUNT(*) AS total</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM customers c</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN invoices i      ON c.CustomerId = i.CustomerId</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN invoice_items ii ON i.InvoiceId = ii.InvoiceId</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN tracks t         ON ii.TrackId = t.TrackId</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN albums al        ON t.AlbumId = al.AlbumId</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY c.Country, al.AlbumId, al.Title</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT acc.Country, acc.Album, acc.total</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="st">FROM album_country_counts acc</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN (</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT Country, MAX(total) AS max_total</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM album_country_counts</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY Country</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="st">) m ON acc.Country = m.Country AND acc.total = m.max_total</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY acc.Country;</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(conn, sql_album_por_pais)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Country
1       Argentina
2       Australia
3         Austria
4         Belgium
5         Belgium
6          Brazil
7          Canada
8           Chile
9           Chile
10          Chile
11 Czech Republic
12        Denmark
13        Denmark
14        Finland
15        Finland
16         France
17         France
18        Germany
19        Germany
20        Hungary
21          India
22        Ireland
23          Italy
24    Netherlands
25         Norway
26         Norway
27         Poland
28       Portugal
29       Portugal
30          Spain
31         Sweden
32            USA
33 United Kingdom
34 United Kingdom
                                                              Album total
1                                                          Acústico     4
2                                                      The X Factor     4
3                          My Generation - The Very Best Of The Who     4
4                                                          Big Ones     4
5                                      Rotten Apples: Greatest Hits     4
6                                               Use Your Illusion I     7
7                                                        Arquivo II     9
8                        My Way: The Best Of Frank Sinatra [Disc 1]     3
9                                    Battlestar Galactica, Season 3     3
10                                                 Heroes, Season 1     3
11                                                     Prenda Minha     5
12                                                Chronicle, Vol. 1     4
13                                                        Mezmerize     4
14                                                    Greatest Kiss     5
15                                                    Greatest Hits     5
16                                                   Minha Historia     7
17                                                Chronicle, Vol. 1     7
18                                          Djavan Ao Vivo - Vol. 1     5
19                                                        Unplugged     5
20                                                              Pop     4
21                                                      Up An' Atom     6
22                                                   Lost, Season 2     7
23                                                         Acústico     4
24                                                          In Step     4
25                            For Those About To Rock We Salute You     4
26                       Cássia Eller - Coleção Sem Limite [Disc 2]     4
27                                                   Rattle And Hum     4
28                                                      Raul Seixas     4
29 Instant Karma: The Amnesty International Campaign to Save Darfur     4
30                         My Generation - The Very Best Of The Who     5
31                                                      Volume Dois     4
32                                             The Office, Season 3    14
33                                          No Prayer For The Dying     5
34                                                             Load     5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consulta SQL:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Usa um CTE (WITH) para contar quantas vezes cada álbum foi comprado em cada país.</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Em seguida, seleciona apenas o álbum com maior contagem por país.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - 'ORDER BY acc.Country' organiza os resultados em ordem alfabética de país.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Qual o artista mais tocado por país?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Artista mais tocado por país </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>sql_artista_por_pais <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="st">WITH artist_country_counts AS (</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT c.Country,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="st">         ar.ArtistId,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="st">         ar.Name AS Artist,</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="st">         COUNT(*) AS total</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM customers c</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN invoices i      ON c.CustomerId = i.CustomerId</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN invoice_items ii ON i.InvoiceId = ii.InvoiceId</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN tracks t         ON ii.TrackId = t.TrackId</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN albums al        ON t.AlbumId = al.AlbumId</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN artists ar       ON al.ArtistId = ar.ArtistId</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY c.Country, ar.ArtistId, ar.Name</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT acc.Country, acc.Artist, acc.total</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="st">FROM artist_country_counts acc</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN (</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT Country, MAX(total) AS max_total</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM artist_country_counts</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY Country</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="st">) m ON acc.Country = m.Country AND acc.total = m.max_total</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY acc.Country;</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(conn, sql_artista_por_pais)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Country                       Artist total
1       Argentina                    Metallica     6
2       Australia                  Iron Maiden    18
3         Austria                           U2     9
4         Belgium                Faith No More     9
5          Brazil      Os Paralamas Do Sucesso    11
6          Brazil                    Pearl Jam    11
7          Canada      Os Paralamas Do Sucesso    16
8           Chile                 Led Zeppelin     6
9  Czech Republic                  Iron Maiden     9
10 Czech Republic                           U2     9
11        Denmark Creedence Clearwater Revival     7
12        Finland                    Van Halen     6
13         France Creedence Clearwater Revival    11
14        Germany                  Iron Maiden    14
15        Hungary                   Jamiroquai     5
16        Hungary                   The Office     5
17          India                  Iron Maiden     8
18        Ireland                         Lost     8
19          Italy                Faith No More     5
20          Italy           The Rolling Stones     5
21    Netherlands        Red Hot Chili Peppers     6
22         Norway                 Led Zeppelin     9
23         Poland                           U2     6
24       Portugal                  Iron Maiden    16
25          Spain                    Pearl Jam     6
26         Sweden                        Titãs     5
27            USA                  Iron Maiden    34
28 United Kingdom                    Metallica     9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consulta SQL:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Parecida com a anterior, mas agora conta quantas vezes cada artista foi ouvido em cada país.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Retorna apenas o artista mais tocado por país.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="11" type="1">
<li>Desconecte do banco de dados.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(conn)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Encerra a conexão com o banco de dados, liberando os recursos.</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># É uma boa prática sempre fechar a conexão ao final do uso.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>